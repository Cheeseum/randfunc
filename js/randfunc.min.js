/*! randfunc - v0.0.3 - 2016-03-21
* Copyright (c) 2016 Cheeseum; License: MPL-2.0 */
function randInt(a,b){return a+Math.floor(Math.random()*(++b-a))}function randChoose(a){return a[randInt(0,a.length-1)]}function randChooseMany(a,b){return shuffle(a).slice(0,b)}function peek(a){return a[a.length-1]}function exclude(a,b){var c=a.indexOf(b);if(-1==c)return a;var d=a.slice();return d.splice(c,1),d}function decorate(a){return"{"+a+"}"}function decorateIfObject(a){return"object"==typeof a?decorate(a):a}var variables=["x","y","z","t","u","v","w","r","s"],funcs=["sin","cos","tan","sinh","cosh","arctan","arccos","ln"],operators=["+","-","*","/","^"];shuffle=function(a){for(var b,c,d=a.slice(),e=d.length;0!==e;)c=Math.floor(Math.random()*e),e-=1,b=d[e],d[e]=d[c],d[c]=b;return d};var OpNode=function(){this.operator,this.left,this.right,arguments[0]&&(this.operator=arguments[0]),arguments[1]&&(this.left=arguments[1]),arguments[2]&&(this.right=arguments[2])};OpNode.prototype.toString=function(){switch(this.operator){case"*":return decorate(this.left)+decorate(this.right);case"/":return"\\frac"+decorate(this.left)+decorate(this.right);default:return decorateIfObject(this.left)+this.operator+decorateIfObject(this.right)}},OpNode.prototype.setOperands=function(a,b){this.left=a,this.right=b};var ComposeOpNode=function(){this.operator="COMPOSE",this.left=null,this.func,this.right,arguments[0]&&(this.func=arguments[0]),arguments[1]&&(this.right=arguments[1])};ComposeOpNode.prototype.setOperands=function(a,b){this.func=a,this.right=b},ComposeOpNode.prototype.toString=function(){return"\\"+this.func+"("+this.right+")"};var randExpr=function(a){var b=[],c=randVarConstPair(a);b.push(c[0]),b.push(c[1]),b.push(new OpNode(randChoose(operators),b.pop(),b.pop()));for(var d=0;d<randInt(1,5);++d)switch(randInt(0,1)){case 0:var c=randVarConstPair(a);b.push(c[0]),(b.length<2||Math.random()<.5)&&b.push(c[1]),b.push(new OpNode(randChoose(operators),b.pop(),b.pop()));break;case 1:b.push(new ComposeOpNode(randChoose(funcs),b.pop()))}for(;b.length>1;)b.push(new OpNode(randChoose(operators),b.pop(),b.pop()));return b[0].toString()},randVarConst=function(a){return Math.random()<.6?randInt(1,16):randChoose(a)},randVarConstPair=function(a){return shuffle([randInt(1,16),randChoose(a)])},randExprNode=function(a,b){switch(randInt(0,1)){case 0:a.addOperand(randVarConst(b)),a.addOperand(randVarConst(b)),a.addOperator(new OpNode(randChoose(operators)));break;case 1:a.addOperand(randChoose(funcs)),a.addOperator(new ComposeOpNode)}},Node=function(){this.value="",this.func="",this.children=[]};Node.prototype.hasChildren=function(){return this.children.length>0},Node.prototype.append=function(a){this.children.push(a)},Node.prototype.concat=function(a){this.children=this.children.concat(a)},Node.prototype.appendToLeavesWithChance=function(a,b,c){if(-1==c.indexOf(this))if(c.push(this),0==this.children.length)for(var d=0;d<a.length;++d)Math.random()<b&&this.children.push(a[d]);else for(var d=0;d<this.children.length;++d)this.children[d].appendToLeavesWithChance(a,b,c)},Node.prototype.constructFunctions=function(a){if(-1==a.indexOf(this)){a.push(this);for(var b=[],c=0;c<this.children.length;++c)b.push(this.children[c].value),this.children[c].constructFunctions(a);this.hasChildren()&&(this.func=randExpr(b))}},Node.prototype.getLeaves=function(){if(this.children.length>0){for(var a=[],b=0;b<this.children.length;++b)a.concat(this.children[b].getLeaves());return a}return[this]},Node.prototype.toTreeString=function(a){for(var b="",c=0;a>c;++c)b+="    ";b+=this.value+": "+this.func+"\n";for(var c=0;c<this.children.length;++c)b+=this.children[c].toTreeString(a+1);return b},Node.prototype.toString=function(){return this.value+" = "+this.func};var FunctionTree=function(){this._root=new Node};FunctionTree.prototype.setVarNames=function(a){this._root.value="f(";for(var b=0;b<a.length;++b)b>0&&(this._root.value+=", "),this._root.value+=a[b];this._root.value+=")"},FunctionTree.prototype.constructFunctions=function(){this._root.constructFunctions([])},FunctionTree.prototype.appendToLeavesWithChance=function(a,b){for(var c=[],d=0;d<a.length;++d){var e=new Node;e.value=a[d],c.push(e)}this._root.appendToLeavesWithChance(c,b,[])},FunctionTree.prototype.toString=function(){return this._root.toTreeString(0)},FunctionTree.prototype.getFunctions=function(){for(var a=[this._root],b=[],c=[];a.length>0;){var d=a.shift();-1==b.indexOf(d)&&(b.push(d),a=a.concat(d.children),d.hasChildren()&&c.push(d.toString()))}return c};var tree,avars,lvars,main=function(){for(tree=new FunctionTree,avars=shuffle(variables),tree.setVarNames(avars);avars.length>0;)lvars=avars.splice(0,randInt(1,3)),tree.appendToLeavesWithChance(lvars,.5*Math.random()+.5);tree.constructFunctions(),console.log(tree.getFunctions().join("\n"))},generateDisplayNewFunction=function(){for(tree=new FunctionTree,avars=shuffle(variables),tree.setVarNames(avars);avars.length>0;)lvars=avars.splice(0,randInt(1,3)),tree.appendToLeavesWithChance(lvars,.5*Math.random()+.5);tree.constructFunctions();var a=document.getElementById("funcs"),b=tree.getFunctions();a.innerHTML="";for(var c=0;c<b.length;++c)a.innerHTML+="$$"+b[c]+"$$<br>"};